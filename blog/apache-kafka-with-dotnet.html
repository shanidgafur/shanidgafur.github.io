<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Apache Kafka Integration with .net</title>
  <meta name="description" content="This blog talks about software and systems integration. No developers were harmed in the creation of this blog.. well, mostly, anyway..">
  <meta name="author" content="Shanid Gafur">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="about:software">
  <meta name="twitter:description" content="This blog talks about software and systems integration. No developers were harmed in the creation of this blog.. well, mostly, anyway..">

  <meta property="og:type" content="article">
  <meta property="og:title" content="about:software">
  <meta property="og:description" content="This blog talks about software and systems integration. No developers were harmed in the creation of this blog.. well, mostly, anyway..">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://shanidgafur.github.io//blog/apache-kafka-with-dotnet">
  <link rel="alternate" type="application/rss+xml" title="about:software" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of about:software">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">about:software</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">This blog talks about software and systems integration. No developers were harmed in the creation of this blog.. well, mostly, anyway..</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to about:software blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/about" title="link to about:software about" class="blog-button">About</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/shanidgafur" title="shanidgafur on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/shanidgafur" title="shanidgafur on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="12 Apr 2016" class="post-meta__date date">12 Apr 2016</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#Apache Kafka">Apache Kafka</a> <a href="/tags/#Integration">Integration</a> </span>
    </div>
    <h1 class="post-title">Apache Kafka Integration with .net</h1>
  </header>

  <section class="post">
    <p>In my last post on <a href="/blog/apache-avro-on-dotnet">Apache Avro</a>, I hinted at additional use cases for Avro serialzed data. In this post, I’d like to walk through serializing my data to an <a href="https://kafka.apache.org/">Apache Kafka</a> topic.</p>

<p>For anyone who is not familiar with it yet, Apache Kafka is a high throughput, distributed, partitioned messaging system. Data is published to Kafka topics where it will become available for consumption by any number of consumers subscribing to the topic.</p>

<h3 id="solution-setup">Solution Setup</h3>

<p>One of the interesting things about the Kafka project, is that the implementation for Kafka clients (other than the default jvm client) is not maintained by the project. The idea is for outside implementers who are more familiar with their development platforms have greater velocity in developing clients. For .net itself, the project <a href="https://cwiki.apache.org/confluence/display/KAFKA/Clients#Clients-.net">lists</a> quite a few different external implementations. Unfortunately, not all these appeared to be in the same levels of completion and required a bit of poking around to figure things out. For the little project that I was looking at, we eventually decided to go with Microsoft’s implememtation called <a href="https://github.com/Microsoft/Kafkanet">Kafkanet</a>.</p>

<p>In order to use the Kafkanet client, start off by downloading the source code and building the solution. So as to make it easier to consume in my solution, I packaged up the binaries in a nuget package. The only dependency needed for this nuget package was the Apache Zookeeper .net client which is available on nuget.org. I’ve added my nuspec file below for reference, should you need it..</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/packaging/2012/06/nuspec.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;metadata&gt;</span>
        <span class="nt">&lt;id&gt;</span>Microsoft.Kafkanet<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.0.58.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;title&gt;</span>KafkaNet.Library<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;authors&gt;</span>Microsoft<span class="nt">&lt;/authors&gt;</span>
        <span class="nt">&lt;projectUrl&gt;</span>https://github.com/Microsoft/Kafkanet<span class="nt">&lt;/projectUrl&gt;</span>
        <span class="nt">&lt;iconUrl&gt;</span>https://kafka.apache.org/images/kafka_logo.png<span class="nt">&lt;/iconUrl&gt;</span>
        <span class="nt">&lt;requireLicenseAcceptance&gt;</span>false<span class="nt">&lt;/requireLicenseAcceptance&gt;</span>
        <span class="nt">&lt;description&gt;</span>Build of Microsoft Kafkanet solution https://github.com/Microsoft/Kafkanet<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;dependencies&gt;</span>
            <span class="nt">&lt;group</span> <span class="na">targetFramework=</span><span class="s">".NETFramework4.5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;dependency</span> <span class="na">id=</span><span class="s">"ZooKeeper.Net"</span> <span class="na">version=</span><span class="s">"3.4.6.2"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/group&gt;</span>
        <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;/metadata&gt;</span>
    <span class="nt">&lt;files&gt;</span>
        <span class="nt">&lt;file</span> <span class="na">src=</span><span class="s">"lib\KafkaNET.Library.dll"</span> <span class="na">target=</span><span class="s">"lib\KafkaNET.Library.dll"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/files&gt;</span>
<span class="nt">&lt;/package&gt;</span></code></pre></figure>

<h3 id="sample-code">Sample code</h3>

<p>Picking up where I left off the Avro serialization example, here’s some sample code that takes the data and pushes that over to a Kafka topic</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">//Connect to Kafka instance
</span><span class="n">var</span> <span class="n">brokerConfig</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BrokerConfiguration</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">BrokerId</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
	<span class="n">Host</span> <span class="p">=</span> <span class="s">"kafka-dev-instance"</span><span class="p">,</span>
	<span class="n">Port</span> <span class="p">=</span> <span class="m">9092</span>
<span class="p">}</span>
<span class="n">var</span> <span class="n">config</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ProducerConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">BrokerConfiguration</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">brokerConfig</span> <span class="p">});</span>

<span class="c1">//Create Avro serialized stream 
</span><span class="n">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">();</span>
<span class="n">Encoder</span> <span class="n">encoder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Avro</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="nf">BinaryEncoder</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="n">var</span> <span class="n">writer</span> <span class="p">=</span> 
	<span class="k">new</span> <span class="n">Avro</span><span class="p">.</span><span class="n">Specific</span><span class="p">.</span><span class="n">SpecificWriter</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">&gt;(</span><span class="k">new</span> <span class="nf">SpecificDefaultWriter</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">Schema</span><span class="p">));</span>
<span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">encoder</span><span class="p">);</span> 

<span class="c1">//Publish to Kafka
</span><span class="n">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Kafka</span><span class="p">.</span><span class="n">Client</span><span class="p">.</span><span class="n">Messages</span><span class="p">.</span><span class="nf">Message</span><span class="p">(</span><span class="n">stream</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>
<span class="n">var</span> <span class="n">producerData</span> <span class="p">=</span> 
	<span class="k">new</span> <span class="n">ProducerData</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Kafka</span><span class="p">.</span><span class="n">Client</span><span class="p">.</span><span class="n">Messages</span><span class="p">.</span><span class="n">Message</span><span class="p">&gt;(</span><span class="s">"kafka-topicname"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="n">msg</span><span class="p">);</span>
<span class="k">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">producer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Kafka</span><span class="p">.</span><span class="n">Client</span><span class="p">.</span><span class="n">Messages</span><span class="p">.</span><span class="n">Message</span><span class="p">&gt;(</span><span class="n">config</span><span class="p">))</span>
<span class="p">{</span>
	<span class="n">producer</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">producerData</span><span class="p">);</span>
<span class="p">}</span> </code></pre></figure>

<p>… and voila, you are now writing your Avro serilialized data into a Kafka topic. As you can see, the code is mostly straight forward but it did take a few hours of digging in to the code to get this right.</p>

<p>Hope this proves helpful to anyone else trying to do something similar. As always, feel free to leave a comment.</p>


  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shanid'; // required: replace example with your forum shortname
        var disqus_config = function () {
          this.page.url = 'https://shanidgafur.github.io/blog/apache-kafka-with-dotnet';
          this.page.identifier = '/blog/Integrating-with-Apache-Kafka';
          this.page.title = 'Apache Kafka Integration with .net';
        };
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2017 Shanid Gafur. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-597490-5', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>